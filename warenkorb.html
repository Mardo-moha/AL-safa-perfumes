<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AL-SAFA | Ihr Warenkorb</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        emailjs.init('dr6WH9zyJ271m0Lr5'); // Ersetze das mit deinem Public Key von EmailJS
    </script>
</head>
<body>
    <!-- Header Bereich (unverändert) -->
    <header id="main-header">
        <div class="container header-container">
            <div class="logo-container">
                <img src="logo2.jpg" alt="AL-SAFA Luxusparfüme" class="logo" onerror="this.style.display='none'">
            </div>
            
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Heim</a></li>
                    <li><a href="index.html#kollektion">Kollektion</a></li>
                    <li><a href="index.html#handwerk">Handwerk</a></li>
                    <li><a href="index.html#atelier">Atelier</a></li>
                    <li><a href="index.html#kontakt">Kontakt</a></li>
                </ul>
            </nav>
            
            <div class="header-actions">
                <a href="#suche" aria-label="Suche"><i class="fas fa-search"></i></a>
                <a href="#konto" aria-label="Konto"><i class="fas fa-user"></i></a>
                <a href="warenkorb.html" aria-label="Warenkorb" class="cart-icon">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="cart-count">0</span>
                    <span id="warenkorb-zaehler" class="cart-count">0</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Warenkorb Hauptinhalt -->
    <main class="cart-page">
        <div class="container">
            <h1 class="page-title">Ihr Warenkorb</h1>
            
            <div class="cart-grid">
                <!-- Warenkorb Artikel -->
                <section class="cart-items-section">
                    <div class="cart-actions">
                        <span id="item-count">0 Artikel</span>
                        <button class="text-btn" id="clear-cart">Warenkorb leeren</button>
                    </div>
                    
                    <div class="cart-items" id="cart-items-container">
                        <div class="empty-cart-message">
                            <i class="fas fa-shopping-bag"></i>
                            <p>Ihr Warenkorb ist leer</p>
                            <a href="index.html#kollektion" class="btn">Zur Kollektion</a>
                        </div>
                    </div>
                </section>
                
                <!-- Bestellzusammenfassung -->
                <aside class="cart-summary">
                    <h2 class="summary-title">Bestellübersicht</h2>
                    
                    <div class="summary-details">
                        <div class="summary-row">
                            <span>Zwischensumme:</span>
                            <span class="subtotal">0,00€</span>
                        </div>
                        <div class="summary-row">
                            <span>Versand:</span>
                            <span class="shipping">5,99€</span>
                        </div>
                        <div class="summary-row total">
                            <span>Gesamtsumme:</span>
                            <span class="total-price">5,99€</span>
                        </div>
                    </div>
                    
                    <form id="checkout-form" class="checkout-form">
                        <h3>Kontaktinformationen</h3>
                        <div class="form-group">
                            <input type="text" id="vorname" name="vorname" placeholder="Vorname" required>
                        </div>
                        <div class="form-group">
                            <input type="text" id="nachname" name="nachname" placeholder="Nachname" required>
                        </div>
                        <div class="form-group">
                            <input type="email" id="email" name="email" placeholder="E-Mail" required>
                        </div>
                        <div class="form-group">
                            <input type="tel" id="telefon" name="telefon" placeholder="Telefon">
                        </div>

                        <h3>Lieferadresse</h3>
                        <div class="form-group">
                            <input type="text" id="strasse" name="strasse" placeholder="Straße und Hausnummer" required>
                        </div>
                        <div class="form-group">
                            <input type="text" id="plz" name="plz" placeholder="PLZ" required>
                        </div>
                        <div class="form-group">
                            <input type="text" id="stadt" name="stadt" placeholder="Stadt" required>
                        </div>
                        <div class="form-group">
                            <select id="land" name="land" required>
                                <option value="">Land auswählen</option>
                                <option value="DE">Deutschland</option>
                                <option value="AT">Österreich</option>
                                <option value="CH">Schweiz</option>
                            </select>
                        </div>

                        <button type="submit" class="btn checkout-btn">Bestellung abschließen</button>
                    </form>

                    <div id="order-confirmation" style="display:none;">
                        <h2>Vielen Dank für Ihre Bestellung!</h2>
                        <p>Wir haben Ihre Bestellung #<span id="order-number"></span> erhalten.</p>
                        <p>Eine Bestätigung wurde an <span id="customer-email"></span> gesendet.</p>
                    </div>
                    
                    <div class="payment-methods">
                        <p>Sicher bezahlen mit:</p>
                        <div class="payment-icons">
                            <i class="fab fa-cc-paypal"></i>
                            <i class="fab fa-cc-visa"></i>
                            <i class="fab fa-cc-mastercard"></i>
                            <i class="fab fa-cc-apple-pay"></i>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h4>Kollektionen</h4>
                    <ul class="footer-links">
                        <li><a href="index.html#kollektion">Signature</a></li>
                        <li><a href="index.html#kollektion">Private Blend</a></li>
                        <li><a href="index.html#kollektion">Les Exclusifs</a></li>
                        <li><a href="index.html#kollektion">Archives</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4>Service</h4>
                    <ul class="footer-links">
                        <li><a href="#">Beratung</a></li>
                        <li><a href="#">Maßanfertigung</a></li>
                        <li><a href="#">Geschenkservice</a></li>
                        <li><a href="#">Retouren</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4>Kontakt</h4>
                    <ul class="contact-info">
                        <li>
                            <i class="fas fa-phone"></i>
                            <span>+49 155 60569138</span>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <span>nassarmuhamad17@gmail.com</span>
                        </li>
                        <li>
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Parfümstraße 1, 10115 Berlin</span>
                        </li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4>Newsletter</h4>
                    <form class="newsletter-form">
                        <input type="email" class="newsletter-input" placeholder="Ihre E-Mail" required>
                        <button type="submit" class="newsletter-btn">Anmelden</button>
                    </form>
                    <div class="social-links">
                        <a href="https://www.instagram.com/al_safa_parfums" aria-label="Instagram" target="_blank">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Pinterest"><i class="fab fa-pinterest-p"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2025 AL-SAFA Parfumeur. Alle Rechte vorbehalten.</p>
            </div>
        </div>
    </footer>

    <script>
        // Warenkorb-Logik
        document.addEventListener('DOMContentLoaded', function() {
            let cart = JSON.parse(localStorage.getItem('warenkorb')) || [];
            const cartContainer = document.getElementById('cart-items-container');
            const itemCountElement = document.getElementById('item-count');
            const subtotalElement = document.querySelector('.subtotal');
            const totalPriceElement = document.querySelector('.total-price');
            const cartCountElements = document.querySelectorAll('.cart-count');

            // Warenkorb anzeigen
            function updateCartDisplay() {
                if (cart.length === 0) {
                    cartContainer.innerHTML = `
                        <div class="empty-cart-message">
                            <i class="fas fa-shopping-bag"></i>
                            <p>Ihr Warenkorb ist leer</p>
                            <a href="index.html#kollektion" class="btn">Zur Kollektion</a>
                        </div>`;
                } else {
                    let html = '';
                    let gesamt = 0;
                    
                    cart.forEach(item => {
                        const preis = item.preis * item.menge;
                        gesamt += preis;
                        html += `
                            <div class="cart-item">
                                <strong>${item.name}</strong><br>
                                ${item.menge} x ${item.preis.toFixed(2)}€ = <strong>${preis.toFixed(2)}€</strong>
                            </div>`;
                    });

                    cartContainer.innerHTML = html;
                    itemCountElement.textContent = `${cart.length} Artikel`;
                    subtotalElement.textContent = `${gesamt.toFixed(2)}€`;
                    totalPriceElement.textContent = `${(gesamt + 5.99).toFixed(2)}€`;
                }

                const totalItems = cart.reduce((sum, item) => sum + item.menge, 0);
                cartCountElements.forEach(el => el.textContent = totalItems);
            }

            // Warenkorb leeren
            document.getElementById('clear-cart')?.addEventListener('click', function() {
                localStorage.removeItem('warenkorb');
                cart = [];
                updateCartDisplay();
            });

            // Bestellung abschließen
            document.getElementById('checkout-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Formulardaten sammeln
                const formData = {
                    vorname: document.getElementById('vorname').value,
                    nachname: document.getElementById('nachname').value,
                    email: document.getElementById('email').value,
                    telefon: document.getElementById('telefon').value,
                    strasse: document.getElementById('strasse').value,
                    plz: document.getElementById('plz').value,
                    stadt: document.getElementById('stadt').value,
                    land: document.getElementById('land').value
                };

                // Bestellnummer generieren
                const bestellnummer = 'AL-' + Date.now();

                try {
                    // 1. An deine API senden (für Telegram)
                    const response = await fetch('/api/bestellung', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            customer: formData,
                            items: cart,
                            bestellnummer: bestellnummer
                        })
                    });

                    if (!response.ok) throw new Error('API-Fehler');

                    // 2. E-Mail-Bestätigung senden
                    const emailParams = {
                        customer_name: `${formData.vorname} ${formData.nachname}`,
                        customer_email: formData.email,
                        order_number: bestellnummer,
                        order_items: cart.map(item => 
                            `${item.name} (${item.menge}x): ${item.preis.toFixed(2)}€`).join('<br>'),
                        total: (cart.reduce((sum, item) => sum + (item.preis * item.menge), 0) + 5.99).toFixed(2),
                        delivery_address: `
                            ${formData.strasse}<br>
                            ${formData.plz} ${formData.stadt}<br>
                            ${formData.land}
                        `
                    };

                    await emailjs.send(
                        'service_zasjwb2', // Ersetze mit deiner Service-ID
                        'mjf1s62', // Ersetze mit deiner Template-ID
                        emailParams
                    );

                    // Erfolgsmeldung anzeigen
                    document.getElementById('checkout-form').style.display = 'none';
                    document.getElementById('order-confirmation').style.display = 'block';
                    document.getElementById('order-number').textContent = bestellnummer;
                    document.getElementById('customer-email').textContent = formData.email;
                    
                    // Warenkorb leeren
                    localStorage.removeItem('warenkorb');
                    cart = [];
                    updateCartDisplay();

                } catch (error) {
                    console.error('Fehler:', error);
                    alert('Bestellung fehlgeschlagen! Bitte versuchen Sie es später erneut.');
                }
            });

            // Initialisierung
            updateCartDisplay();
        });
    </script>
</body>
</html>